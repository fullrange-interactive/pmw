/*global pmw, $*/pmw.Controllers = pmw.Controllers || {};(function(global) {    'use strict';    var helpGone = false;    var canSend = true;    var waitTime = 5;    var timeRemaining = 4;    var pleaseWaitInterval = null;    function shuffle(o) {        for (var j, x, i = o.length; i; j = Math.floor(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);        return o;    }    pmw.Controllers.GifController = pmw.Controllers.AbstractController.extend({        pageHeadline: "GIF Corner",        _initViews: function() {            backRoute = "#";            // Create the ContentView with the controller (this) as scope            if (!this.contentView) {                this.contentView = pmw.Views.GifView.create(this, null, true);            }            // Create the HeaderView with the controller (this) as scope            if (!this.headerView) {                this.headerView = pmw.Views.BackheaderView.create(this, null, true);            }            this._applyViews();            var that = this;            $.get(global.pmw.options.serverUrl + "/vjing", {                listImages: 1            }, function(data) {                that.vjImages = data;                that.fillGallery(that);                $("#gif-gallery").slick({                    lazyLoad: 'ondemand',                    prevArrow: '#slide-previous',                    nextArrow: '#slide-next'                });            }, 'json');            window.addEventListener('resize', this.resizeCanvas, false);            window.addEventListener('orientationchange', this.resizeCanvas, false);            this.resizeCanvas();            $("#gif-gallery").on("tap", function(e) {                e.preventDefault();                if (helpGone === true) {                    this.sendClip();                }            }.bind(this));            $(".page-gif").on("touch", function() {                $("#gif-help").fadeOut(500, function() { helpGone = true;                    console.log("helpgone") });            })            $(".page-gif").on("touchstart", function() {                $("#gif-help").fadeOut(500, function() { helpGone = true;                    console.log("helpgone") });            })            $(".page-gif").on("click", function() {                $("#gif-help").fadeOut(500, function() { helpGone = true;                    console.log("helpgone") });            })            setTimeout(function() {                $("#gif-help").fadeOut(500, function() { helpGone = true;                    console.log("helpgone") });            }, 3000)            setTimeout(function() {                $("#gif-gallery").trigger("resize");            }, 100)            var current = this;        },        fillGallery: function() {            console.log(this.vjImages);            this.vjImages = shuffle(this.vjImages);            for (var i = 0; i < this.vjImages.length; i++) {                var slide = $('<div class="image"><img data-lazy="' + global.pmw.options.serverUrl + this.vjImages[i] + '"/></div>')                $("#gif-gallery").append(slide)            }        },        sendClip: function() {            if (!canSend) {                return;            }            canSend = false;            var current = this;            var selectedClip;            $("#gif-gallery").find("div.image").each(function() {                if ($(this).hasClass("slick-active")) {                    selectedClip = $(this).find("img").attr("src");                }            })            console.log("sendClip")            $("#gif-flash").css("display", "block")            $("#gif-flash").css("transition", "all 0.05s linear");            $("#gif-flash").css("opacity", 0.8);            setTimeout(function() {                $("#gif-flash").css("transition", "all 1.5s linear");                $("#gif-flash").css("opacity", 0)                setTimeout(function() {                    $("#gif-flash").css("display", "none")                }, 2000)            }, 100)            $.ajax({                url: global.pmw.options.serverUrl + "/vjing",                type: 'post',                data: {                    clip: selectedClip,                    groupId: global.pmw.selectedWindowGroup                },            }).done(function(data) {                data = JSON.parse(data);                if (data.responseType == "ok") {                    M.Toast.show("Ton GIF a été envoyé! Lèveles yeux.");                } else {                    M.Toast.show("Erreur :( Etes-vous toujours connecté à internet?");                    return;                }                timeRemaining = waitTime;                $("#send").css("pointer-events", "none");                $("#send").addClass("disabled");                $("#send").find(".icon-rocket").removeClass("icon-rocket").addClass("fa-clock-o");                $("#send").find(".btn-text").html("Attendre " + timeRemaining + " secondes...");                pleaseWaitInterval = setInterval(function() {                    timeRemaining--;                    if (timeRemaining < 0) {                        timeRemaining = 0;                        canSend = true;                        $("#send").css("pointer-events", "all");                        $("#send").removeClass("disabled");                        $("#send").find(".fa-clock-o").removeClass("fa-clock-o").addClass("icon-rocket");                        $("#send").find(".btn-text").html("Envoyer");                        clearInterval(pleaseWaitInterval);                    } else {                        $("#send").find(".btn-text").html("Attends " + timeRemaining + " secondes...");                    }                }, 1000);            });        },        resizeCanvas: function() {            var winHeight = window.innerHeight ? window.innerHeight : $(window).height();            var winWidth = $(window).width();            var newWidth = 0;            var newHeight = 0;            var heightMargin = $('.toolbarview').height() + $('.tools').height();            // windows size without header and footer            winHeight = winHeight - heightMargin;            $('#gif-gallery').height(winHeight);        }    });})(this);