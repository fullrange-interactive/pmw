!function(a){"use strict";a.pmw=a.pmw||{},a.pmw.mconfig={name:"pmw",serverUrl:"http://10.0.0.100",liveDrawingUrl:"ws://192.168.2.254:8080",liveDrawingPreviewImage:"50.png",defaultWindowGroup:"573d8b7157780e646cce8254",drawingWindowGroup:"55565adc8a8dbbeb37f4b1f0",webappUrl:"http://10.0.0.100:80/webapp-dedicace",winWidth:930,winHeight:759,selectedWindowData:null,routes:{"":"galleryController",dedicacePhoto:"drawPhotoController",photographer:"galleryPhotographerController"}}}(this);var fakeLocalStorage=function(){var a,b={};window.Storage&&window.localStorage?a=window.Storage.prototype:(window.localStorage={},a=window.localStorage),window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));var c=function(b,c){var d=null==b?null:a.getItem(b),e=location.href.substr(location.origin.length),f=document.createEvent("StorageEvent");f.initStorageEvent("storage",!1,!1,b,d,c,e,null),window.dispatchEvent(f)};a.key=function(a){var c=Object.keys(b)[a];return"string"==typeof c?c:null},a.getItem=function(a){return"string"==typeof b[a]?b[a]:null},a.setItem=function(a,d){c(a,d),b[a]=String(d)},a.removeItem=function(a){c(a,null),delete b[a]},a.clear=function(){c(null,null),b={}}};if("object"==typeof window.localStorage)try{localStorage.setItem("localStorageTest",1),localStorage.removeItem("localStorageTest")}catch(e){fakeLocalStorage()}else fakeLocalStorage();var backRoute;!function(a){"use strict";a.pmw=M.Application.extend().create(a.pmw.mconfig),$(document).ready(function(){a.pmw.selectedWindowGroup=a.pmw.options.defaultWindowGroup,a.pmw.selectedGalImage=null,a.pmw.start({routing:{routes:a.pmw.options.routes,galleryController:a.pmw.Controllers.GalleryController.create(),galleryPhotographerController:a.pmw.Controllers.GalleryController.create(!0),drawPhotoController:a.pmw.Controllers.DrawPhotoController.create()}})})}(this),this.JST=this.JST||{},pmw.Views=pmw.Views||{},function(){"use strict";pmw.Views.BackheaderView=M.ToolbarView.extend({scopeKey:"pageHeadline"},{first:M.ButtonView.extend({icon:"icon-angle-left",events:{tap:function(){pmw.navigate({route:backRoute,transition:M.PageTransitions.CONST.MOVE_TO_RIGHT_FROM_LEFT})}}})})}(),pmw.Views=pmw.Views||{},function(){"use strict";pmw.Views.HomeView=M.View.extend({grid:"row"},{tower:M.ImageView.extend({grid:"col-xs-6",cssClass:"col-sm-4 col-md-3 text-center app-icon",value:"images/tower.png",events:{tap:function(){this.setLocationAndChooseFeature("53562d9d3d45fe516a96d161")}}}),entrance:M.ImageView.extend({grid:"col-xs-6",cssClass:"col-sm-4 col-md-3 text-center app-icon",value:"images/entrance.png",events:{tap:function(){this.setLocationAndChooseFeature("53562d9d3d45fe516a96d161")}}}),mainStage:M.ImageView.extend({grid:"col-xs-6",cssClass:"col-sm-4 col-md-3 text-center app-icon",value:"images/main-stage.png",events:{tap:function(){this.setLocationAndChooseFeature("53562d9d3d45fe516a96d161")}}}),interior:M.ImageView.extend({grid:"col-xs-6",cssClass:"col-sm-4 col-md-3 text-center app-icon",value:"images/cafeteria.png",events:{tap:function(){this.setLocationAndChooseFeature("53562d9d3d45fe516a96d161")}}})})}(),pmw.Views=pmw.Views||{},function(){"use strict";pmw.Views.GalleryView=M.View.extend({cssClass:"page-gif",template:'<div id="fb-root"></div>'},{area:M.View.extend({useElement:YES,template:'<div class="img-gallery" id="img-gallery"></div>'})})}(),pmw.Views=pmw.Views||{},function(){"use strict";pmw.Views.DrawPhotoView=M.View.extend({cssClass:"page-drawphoto",template:'<div id="fb-root"></div>'},{tools:M.View.extend({grid:"row",cssClass:"tools toolbarview"},{foregroundColor:M.TextfieldView.extend({grid:"col-xs-2 col-xs-offset-1",value:"",cssClass:"colorpicker foreground",type:"text"}),sizeStroke:M.SelectView.extend({grid:"col-xs-2",scopeKey:"selectionSize.size",cssClass:"selectionSize",selectOptions:{collection:[{id:1,name:"small",value:3},{id:2,name:"medium",value:10},{id:3,name:"large",value:20},{id:4,name:"xlarge",value:30}],labelPath:"name",valuePath:"value"},events:{change:"changeSize"}}),undo:M.ButtonView.extend({grid:"col-xs-2 col-sm-2 col-md-2",icon:"icon-ccw",value:"",events:{tap:"undo"}}),trash:M.ButtonView.extend({grid:"col-xs-2 col-sm-2 col-md-2",cssClass:"m-error",icon:"icon-trash",value:"",events:{tap:"deleteDraw"}}),save:M.ButtonView.extend({grid:"col-xs-2 col-sm-2 col-md-2",cssClass:"m-success",icon:"icon-ok",value:"",events:{tap:"saveDraw"}})}),scratchCanvas:M.View.extend({useElement:YES,template:'<canvas id="scratch-canvas"></canvas>'}),area:M.View.extend({useElement:YES,template:'<div class="contentCanvas drawPhotoCanvas drawPhotoCanvasEmpty"><p style="text-align:center">Loading Canvas...</p></div>'})})}(),pmw.Controllers=pmw.Controllers||{},function(){"use strict";pmw.Controllers.AbstractController=M.Controller.extend({headerView:null,contentView:null,menuView:null,pageHeadline:"",applicationStart:function(a){var b=M.SwitchHeaderContentLayout.extend({}).create(this,null,!0);pmw.setLayout(b),this._initViews(a)},show:function(a){this._initViews(a);var b=M.SwitchHeaderContentLayout.extend({}).create(this,null,!0);b._type===pmw.getLayout()._type?pmw.getLayout().startTransition():this.applicationStart()},applicationReady:function(){},_applyViews:function(){pmw.getLayout().applyViews({header:this.headerView,content:this.contentView})},_initViews:function(){}})}(),pmw.Controllers=pmw.Controllers||{},function(a){"use strict";pmw.Controllers.MenuController=pmw.Controllers.AbstractController.extend({tmpViews:null,_initViews:function(){this.contentView||(this.contentView=pmw.Views.HomeView.create(this,null,!0)),this.headerView||(this.headerView=M.ToolbarView.extend({grid:"col-md-12",value:"Pimp My Wall"}).create()),this._applyViews()},setLocationAndChooseFeature:function(b){a.pmw.selectedWindowGroup=b,localStorage.setItem("selectedWindowGroup",b),pmw.navigate({route:"/chooseFeature"})}})}(this),pmw.Controllers=pmw.Controllers||{},function(a){"use strict";var b=0,c=!1,d=[],e=!1;a.pmw.intervalHandleGallery=null,pmw.Controllers.GalleryController=pmw.Controllers.AbstractController.extend({pageHeadline:"Clique sur l'image à dédicacer!",photographer:!1,constructor:function(a){this.photographer=a},_initViews:function(){this.contentView||(this.contentView=pmw.Views.GalleryView.create(this,null,!0)),this.headerView||(this.headerView=M.ToolbarView.extend({grid:"col-md-12",value:"Choisis une photo à dédicacer"}).create()),this._applyViews(),null===a.pmw.intervalHandleGallery&&(d=[],a.pmw.intervalHandleGallery=window.setInterval(this.updateGallery.bind(this),2e3),this.updateGallery()),window.addEventListener("resize",this.resizeCanvas,!1),window.addEventListener("orientationchange",this.resizeCanvas,!1),$(".content-wrapper").scroll(this.scrollCheck)},updateGallery:function(){$.get(a.pmw.options.serverUrl+"/gallery/",{listImages:1},function(a){this.fillGallery(a)}.bind(this),"json")},scrollCheck:function(){e&&0==$(".content-wrapper").scrollTop()&&($("#show-notif").remove(),e=!1)},fillGallery:function(f){f=f.sort();for(var g=d.length-1;g>=0;g--)if(-1===f.indexOf(d[g])){console.log("Not found "+d[g]);var h=$(".img[data-path='"+d[g]+"']");if(0!==h.length){var i=h.offset().top,j=h.outerHeight(),k=$(".content-wrapper").scrollTop();0>i+j&&$(".content-wrapper").scrollTop(k-j),h.remove()}d.splice(g,1)}for(var g=0;g<f.length;g++)if(-1===d.indexOf(f[g])){b++,b>0&&c===!1&&($(".content-wrapper").append('<div id="show-loading"><p>Chargement des images...</p></div>'),c=!0);var l=$(new Image);d.push(f[g]),l.on("load",function(c,d){b--,0==b&&$("#show-loading").remove(),this.attr("width","100%");var f=$('<div class="img"></div>');if(f.attr("data-path",c),f.append(this),d.photographer){var g=$('<div class="delete">X</div>');g.on("tap click",function(b,c){confirm("Effacer la photo?")===!0&&$.get(a.pmw.options.serverUrl+"/gallery/",{deleteImage:b},function(a){"OK"===a&&c.remove()}.bind(this))}.bind(g,c,f)),f.append(g)}$("#img-gallery").prepend(f),0!=$(".content-wrapper").scrollTop()&&($(".content-wrapper").scrollTop($(".content-wrapper").scrollTop()+this[0].clientHeight),e||($(".content-wrapper").append('<div id="show-notif"><p>Des nouvelles images sont disponibles. Clique ici pour remonter !</p></div>'),$("#show-notif").on("tap click",function(){$(".content-wrapper").scrollTop(0)}),e=!0))}.bind(l,f[g],this)),l.on("tap click",function(b,c){c.preventDefault(),a.pmw.selectedGalImage=this.attr("data-path"),a.pmw.photographer=b.photographer,clearInterval(a.pmw.intervalHandleGallery),a.pmw.intervalHandleGallery=null,pmw.navigate({route:"#dedicacePhoto"})}.bind(l,this)),l.attr("data-path",f[g]),l.attr("src",a.pmw.options.serverUrl+f[g])}}})}(this),pmw.Controllers=pmw.Controllers||{},function(a){"use strict";function b(a,b){function c(a){var b=(a.naturalWidth,a.naturalHeight),c=document.createElement("canvas");c.width=1,c.height=b;var d=c.getContext("2d");d.drawImage(a,0,0);for(var e=d.getImageData(0,0,1,b).data,f=0,g=b,h=b;h>f;){var i=e[4*(h-1)+3];0===i?g=h:f=h,h=g+f>>1}var j=h/b;return 0===j?1:j}var d=c(b),e=arguments.length;switch(e){case 4:a.drawImage(b,arguments[2],arguments[3]/d);break;case 6:a.drawImage(b,arguments[2],arguments[3],arguments[4],arguments[5]/d);break;case 8:a.drawImage(b,arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7]/d);break;case 10:a.drawImage(b,arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9]/d)}}function c(a,b){localStorage.removeItem("StrokesPhoto"),g.push({points:[{x:a,y:b},{x:a+1,y:b+1}],color:l,lineWidth:t}),localStorage.setItem("StrokesPhoto",JSON.stringify(g))}var d,e,f,g,h=function(){if(navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/))return!1;var a=document.createElement("input");return a.type="file",!a.disabled},i=function(){return"undefined"==typeof a.FormData?!1:!0},j=function(){var b=new MobileDetect(window.navigator.userAgent);return"HTC"==b.phone()?(console.log("HTC piece of shit, disabling file reader."),!1):"Samsung"==b.phone()?(console.log("Samsung piece of shit, disabling file reader."),!1):"undefined"==typeof a.FileReader?!1:!0},k=function(){var a=new MobileDetect(window.navigator.userAgent);return a.os()},l="#010101",m=null,n=null,o=500,p=null,q={},r=!1,s=null,t=10;pmw.Controllers.DrawPhotoController=pmw.Controllers.AbstractController.extend({pageHeadline:"Fais un petit dessin!",selectionSize:M.Model.create({size:5}),strokesMin:10,palette:[["FFFFFF","DADADA","D0CDCA","808080","666261","010101"],["F9E813","F8C82F","FBFA0D","F89618"],["6CE013","258400","45B7F9","4680E8","3800EB","44FF00"],["6300A1","CA8BF6","8C0EF4","F687FC","EA00E4","4EFFE6"],["FBE2B7","FA6F76","ED001D","F2A263","8B4212","40C9B9"]],background:null,_initViews:function(){if(k(),backRoute=a.pmw.photographer?"#photographer":"#",!i()||!h())return void alert("Malheureusement votre téléphone n'est pas assez récent et n'est pas compatible avec notre application.");if(this.contentView||(this.contentView=pmw.Views.DrawPhotoView.create(this,null,!0)),this.headerView||(this.headerView=pmw.Views.BackheaderView.create(this,null,!0)),this._applyViews(),$(".colorpicker.foreground input").spectrum({showPaletteOnly:!0,showPalette:!0,color:l,palette:this.palette,change:function(a){l=a.toHexString(),localStorage.setItem("Foreground",a.toHexString())}}),$(".selectionSize .selection-list").sizeChooser(this.changeSize),m=$("#scratch-canvas").get()[0].getContext("2d"),!("url"in window)&&"webkitURL"in window&&(window.URL=window.webkitURL),null!==a.pmw.selectedGalImage){var b=new Image,c=a.pmw.options.serverUrl+a.pmw.selectedGalImage,d=a.pmw.selectedGalImage;console.log("Loading from gallery: "+a.pmw.selectedGalImage),b.onload=function(a){q.width=this.width,q.height=this.height,b=null,a.background=d,localStorage.setItem("BackgroundDrawPhoto",d),localStorage.setItem("BackgroundWidth",q.width),localStorage.setItem("BackgroundHeight",q.height),a.newCanvas(),a.setBackground()}.bind(b,this),b.src=c,a.pmw.selectedGalImage=null}else q.width=localStorage.getItem("BackgroundWidth"),q.height=localStorage.getItem("BackgroundHeight"),this.background=localStorage.getItem("BackgroundDrawPhoto"),this.newCanvas(),this.setBackground()},newCanvas:function(){var a='<canvas id="canvasDrawPhoto" width="'+$(window).width()+'" height="'+($(window).height()-$(".page-drawphoto .toolbarview").height()-$(".page-drawphoto .tools").height())+'"></canvas>';$(".page-drawphoto .contentCanvas").html(a),d=$(".page-drawphoto .contentCanvas canvas")[0],e=$(".page-drawphoto .contentCanvas canvas")[0].getContext("2d"),this.resizeCanvas(),window.addEventListener("resize",this.resizeCanvas.bind(this),!1),window.addEventListener("orientationchange",this.resizeCanvas.bind(this),!1),null!=localStorage.getItem("StrokesPhoto")?(g=JSON.parse(localStorage.getItem("StrokesPhoto")),this.repaint()):g=[],e.strokeStyle=localStorage.getItem("ForegroundPhoto")?localStorage.getItem("ForegroundPhoto"):l,e.lineWidth=t,e.lineCap="round",e.lineJoin="round",$(".page-drawphoto .contentCanvas canvas").drawTouchPhoto(),$(".page-drawphoto .contentCanvas canvas").drawPointerPhoto(),$(".page-drawphoto .contentCanvas canvas").drawMousePhoto()},deleteDraw:function(){confirm("Effacer le dessin?")===!0&&this.clearDraw()},clearDraw:function(){if("drawPhoto"==window.location.hash){$(".drawPhotoCanvas").addClass("drawPhotoCanvasEmpty");var a=[];for(var b in this.palette)for(var c in this.palette[b])a.push(this.palette[b][c]);localStorage.removeItem("StrokesPhoto"),localStorage.removeItem("ForegroundPhoto"),localStorage.removeItem("BackgroundDrawPhoto"),this.newCanvas(),this.repaint()}else localStorage.removeItem("StrokesPhoto"),g=[],this.repaint()},changeSize:function(){t=$(".page-drawphoto .selectionSize select").val(),e.lineWidth=t},undo:function(){g.pop(),this.repaint()},saveDraw:function(){var b=this;console.log(b.background),$('<div title="Confirmation">Envoyer la photo?</div>').dialog({resizable:!1,height:200,modal:!0,draggable:!1,buttons:{Non:function(){$(this).dialog("close")},Oui:function(){var c=g;$.ajax({url:a.pmw.options.serverUrl+"/drawing",type:"post",data:{action:"newDrawing",strokes:c,width:d.width,height:d.height,groupId:a.pmw.options.drawingWindowGroup,background:localStorage.getItem("BackgroundDrawPhoto")}}).done(function(a){b.clearDraw(),localStorage.removeItem("BackgroundDrawPhoto"),a=jQuery.parseJSON(a),M.Toast.show("ok"==a.responseType?"Ta dédicace a été envoyée!":"Erreur lors de l'envoi ! :("),"drawPhoto"!=window.location.hash&&pmw.navigate({route:""})}),$(this).dialog("close")}}})},drawLine:function(a,b,c,d,f,g){e.beginPath(),e.lineCap="round",e.lineJoin="round",e.strokeStyle=a,e.lineWidth=b,e.moveTo(c,d),e.lineTo(f,g),e.stroke(),e.closePath()},resizeCanvas:function(){var a=$(".page-drawphoto .toolbarview").height()+$(".page-drawphoto .tools").height(),b=(window.innerHeight?window.innerHeight:$(window).height())-a,c=$(window).width()/b,f=q.width/q.height;console.log($(".page-drawphoto .contentCanvas canvas").height());var g=e.getImageData(0,0,d.width,d.height);c>f?(d.height=b,d.width=q.width/(q.height/b)):(console.log("a"),d.height=q.height/(q.width/$(window).width()),d.width=$(window).width()),$(".page-drawphoto .contentCanvas").height(d.height),$(".page-drawphoto .contentCanvas").width(d.width),e.putImageData(g,0,0),this.repaint()},repaint:function(){if(g){e.clearRect(0,0,d.width,d.height);for(var a=0;a<g.length;a++)for(var b=0;b<g[a].points.length-1;b++)this.drawLine(g[a].color,g[a].lineWidth,g[a].points[b].x,g[a].points[b].y,g[a].points[b+1].x,g[a].points[b+1].y)}e.lineWidth=t},takePicDone:function(a,c,d){console.log("Read photo");var e=new Image;e.onload=function(){null!=p&&p.hide(),d||EXIF.getData(e,function(){m.setTransform(1,0,0,1,0,0);var a=m.canvas.width,b=m.canvas.height,c=EXIF.getTag(e,"Orientation");if(navigator.userAgent.match(/Windows Phone/i))switch(c){case 2:m.translate(a,0),m.scale(-1,1);break;case 3:m.translate(a,b),m.rotate(Math.PI);break;case 4:m.translate(0,b),m.scale(1,-1);break;case 5:m.rotate(-.5*Math.PI),m.scale(1,-1);break;case 6:m.rotate(-.5*Math.PI),m.translate(0,-b);break;case 7:m.rotate(-.5*Math.PI),m.translate(a,-b),m.scale(-1,1);break;case 8:m.rotate(.5*Math.PI),m.translate(-a,0)}else switch(c){case 2:m.translate(a,0),m.scale(-1,1);break;case 3:m.translate(a,b),m.rotate(Math.PI);break;case 4:m.translate(0,b),m.scale(1,-1);break;case 5:m.rotate(.5*Math.PI),m.scale(1,-1);break;case 6:m.rotate(.5*Math.PI),m.translate(0,-b);break;case 7:m.rotate(.5*Math.PI),m.translate(a,-b),m.scale(-1,1);break;case 8:m.rotate(-.5*Math.PI),m.translate(-a,0)}});var c=e.width,f=e.height,g=c/f,h=0,i=0,j=0,l=0,n=m.canvas.width/m.canvas.height;g>n?(console.log("landscape"),j=f*n,l=f,h=(c-j)/2,console.log(h)):(l=c/n,j=c,i=(f-l)/2);var o=k();return"iOS"==o?(console.log("ios drawimage"),b(m,this,h,i,j,l,0,0,m.canvas.width,m.canvas.height)):(console.log("other drawimage"),m.drawImage(this,h,i,j,l,0,0,m.canvas.width,m.canvas.height)),console.log("photoUploaded = "+r),r?void this.setBackground():void a.sendPhoto()},e.src=this.result},abort:function(){alert("Opération annulée.")},error:function(a){null!=p&&p.hide(),alert("Il y a eu une erreur, merci d'essayer plus tard. Erreur: "+a)},setBackground:function(){$(".drawPhotoCanvas").removeClass("drawPhotoCanvasEmpty"),this.clearDraw(),this.repaint(),$(".page-drawphoto canvas").css("background","url('"+a.pmw.options.serverUrl+this.background+"')"),$(".page-drawphoto canvas").css("background-size","cover"),$(".page-drawphoto canvas").css("background-position","50% 50%")},takePicture:function(b){var c=b.target;if(!c.files||0==c.files.length)return void alert("Tu dois choisir ou prendre une photo!");if(j()){var d=new a.FileReader;d.onabort=this.abort,d.onerror=this.error,d.onload=this.takePicDone.bind(d,this),d.readAsDataURL(c.files[0]),p=M.LoaderView.create().render(),this.bindForceClose()}else{var e=new FormData,f=this;p=M.LoaderView.create().render().show(),this.bindForceClose(),e.append("file",c.files[0]),$.ajax({url:a.pmw.options.serverUrl+"/photo",type:"post",data:e,processData:!1,contentType:!1,responseType:"json"}).done(function(a){a=JSON.parse(a),a.error&&alert(a.error),p.hide(),r=!0,f.background=a.url,f.setBackground(),p.hide(!0)}).fail(function(a){return console.log(a),p&&p.hide(),a.responseText?void alert(a.responseText):void alert("Une erreur s'est produite (connexion au serveur impossible), mais ce n'est pas de ta faute! Merci d'essayer plus tard.")})}},sendPhoto:function(){var b=this;if(r)this.showParticipate();else{var c=m.canvas.toDataURL("image/jpeg",1),d="jpeg";-1!=c.substring(0,30).indexOf("image/png")&&(d="png"),p=M.LoaderView.create().render().show(),this.bindForceClose(),$.post(a.pmw.options.serverUrl+"/photo",{base64Image:c,imageFormat:d},function(a){return null!=p&&p.hide(),a.error?void alert(a.error):(b.background=a.url,void b.setBackground())},"json").fail(function(){null!=p&&p.hide(),alert("Une erreur s'est produite ... mais ce n'est pas de votre faute! Veuillez ressayer plus tard.")})}},bindForceClose:function(){$(".loaderview .view").on("tap mousedown",function(){return null==n?(n=(new Date).getTime(),!1):(new Date).getTime()-n>o?void(n=null):(console.log("remove"),void this.forceCloseLoader())}.bind(this))},forceCloseLoader:function(){console.log(p),null!=p&&p.hide()}}),$.fn.drawTouchPhoto=function(){var a=function(a){a=a.originalEvent,e.beginPath(),e.strokeStyle=l,f=a.changedTouches[0].pageX,s=a.changedTouches[0].pageY-100,e.moveTo(f,s),e.lineTo(f+1,s+1),e.stroke(),c(f,s)},b=function(a){a.preventDefault(),a=a.originalEvent,f=a.changedTouches[0].pageX,s=a.changedTouches[0].pageY-100,e.lineTo(f,s),e.stroke(),g[g.length-1].points.push({x:f,y:s})};$(this).on("touchstart",a),$(this).on("touchmove",b)},$.fn.drawPointerPhoto=function(){var a=function(a){a=a.originalEvent,e.beginPath(),e.strokeStyle=l,f=a.pageX,s=a.pageY-100,e.moveTo(f,s),e.lineTo(f+1,s+1),e.stroke(),c(f,s)},b=function(a){a.preventDefault(),a=a.originalEvent,f=a.pageX,s=a.pageY-100,e.lineTo(f,s),e.stroke(),g[g.length-1].points.push({x:f,y:s})};$(this).on("MSPointerDown",a),$(this).on("MSPointerMove",b)},$.fn.drawMousePhoto=function(){var a=0,b=function(b){a=1,e.beginPath(),e.strokeStyle=l,f=b.pageX,s=b.pageY-100,e.moveTo(f,s),e.lineTo(f+1,s+1),e.stroke(),c(f,s)},d=function(b){a&&(f=b.pageX,s=b.pageY-100,e.lineTo(f,s),e.stroke(),g[g.length-1].points.push({x:f,y:s}))},h=function(){a=0};$(this).on("mousedown",b),$(this).on("mousemove",d),$(window).on("mouseup",h)}}(this);