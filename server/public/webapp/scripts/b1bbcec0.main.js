!function(a){"use strict";a.pmw=a.pmw||{},a.pmw.mconfig={name:"pmw",locales:[{locale:"en"}],serverUrl:"http://bill.pimp-my-wall.ch",liveDrawingUrl:"ws://bill.pimp-my-wall.ch:8080",liveDrawingPreviewId:"301"}}(this);var fakeLocalStorage=function(){var a,b={};window.Storage&&window.localStorage?a=window.Storage.prototype:(window.localStorage={},a=window.localStorage),window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));var c=function(b,c){var d=null==b?null:a.getItem(b),e=location.href.substr(location.origin.length),f=document.createEvent("StorageEvent");f.initStorageEvent("storage",!1,!1,b,d,c,e,null),window.dispatchEvent(f)};a.key=function(a){var c=Object.keys(b)[a];return"string"==typeof c?c:null},a.getItem=function(a){return"string"==typeof b[a]?b[a]:null},a.setItem=function(a,d){c(a,d),b[a]=String(d)},a.removeItem=function(a){c(a,null),delete b[a]},a.clear=function(){c(null,null),b={}}};if("object"==typeof window.localStorage)try{localStorage.setItem("localStorageTest",1),localStorage.removeItem("localStorageTest")}catch(e){fakeLocalStorage()}else fakeLocalStorage();var backRoute;!function(a){"use strict";a.pmw=M.Application.extend().create(a.pmw.mconfig),$(document).ready(function(){a.pmw.selectedWindowGroup=localStorage.getItem("selectedWindowGroup"),a.pmw.start({routing:{routes:{"":"drawLiveController"},drawLiveController:a.pmw.Controllers.DrawLiveController.create()}})})}(this),this.JST=this.JST||{},pmw.Models=pmw.Models||{},function(){"use strict";pmw.Models.TmpviewModel=M.Model.extend({})}(),pmw.Collections=pmw.Collections||{},function(){"use strict";pmw.Collections.TmpviewsCollection=M.Collection.extend({model:pmw.Models.TmpviewModel})}(),pmw.Views=pmw.Views||{},function(){"use strict";pmw.Views.BackheaderView=M.ToolbarView.extend({scopeKey:"pageHeadline"},{first:M.ButtonView.extend({icon:"fa-angle-left",events:{tap:function(){pmw.navigate({route:backRoute,transition:M.PageTransitions.CONST.MOVE_TO_RIGHT_FROM_LEFT})}}}),second:M.View.extend({useElement:YES,template:'<div class="logo"><img src="images/Logo.png" /></div>'})})}(),pmw.Views=pmw.Views||{},function(){"use strict";pmw.Views.HomeView=M.View.extend({grid:"row"},{tower:M.ImageView.extend({grid:"col-xs-6",cssClass:"col-sm-4 col-md-3 text-center app-icon",value:"images/tower.png",events:{tap:function(){this.setLocationAndChooseFeature("53562d9d3d45fe516a96d161")}}}),entrance:M.ImageView.extend({grid:"col-xs-6",cssClass:"col-sm-4 col-md-3 text-center app-icon",value:"images/entrance.png",events:{tap:function(){this.setLocationAndChooseFeature("53562d9d3d45fe516a96d161")}}}),mainStage:M.ImageView.extend({grid:"col-xs-6",cssClass:"col-sm-4 col-md-3 text-center app-icon",value:"images/main-stage.png",events:{tap:function(){this.setLocationAndChooseFeature("53562d9d3d45fe516a96d161")}}}),interior:M.ImageView.extend({grid:"col-xs-6",cssClass:"col-sm-4 col-md-3 text-center app-icon",value:"images/cafeteria.png",events:{tap:function(){this.setLocationAndChooseFeature("53562d9d3d45fe516a96d161")}}})})}(),pmw.Views=pmw.Views||{},function(){"use strict";pmw.Views.DrawLiveView=M.View.extend({cssClass:"page-draw",template:'<div id="fb-root"></div>'},{tools:M.View.extend({grid:"row",cssClass:"tools toolbarview"},{foregroundColor:M.TextfieldView.extend({grid:"col-xs-4",value:"",cssClass:"colorpicker foreground",type:"text"}),sizeStroke:M.SelectView.extend({grid:"col-xs-4",scopeKey:"selectionSize.size",cssClass:"selectionSize",selectOptions:{collection:[{id:1,name:"small",value:3},{id:2,name:"medium",value:10},{id:3,name:"large",value:20},{id:4,name:"xlarge",value:30}],labelPath:"name",valuePath:"value"},events:{change:"changeSize"}}),refreshPreview:M.ButtonView.extend({grid:"col-xs-4",id:"send",cssClass:"m-success refreshPreview",value:'<i class="fa fa-refresh" />',events:{tap:"refreshPreview"}})}),area:M.View.extend({useElement:YES,template:'<div id="contentCanvas"><p style="text-align:center">Loading Canvas...</p></div>'})})}(),pmw.Controllers=pmw.Controllers||{},function(){"use strict";pmw.Controllers.AbstractController=M.Controller.extend({headerView:null,contentView:null,menuView:null,pageHeadline:"",applicationStart:function(a){var b=M.SwitchHeaderContentLayout.extend({}).create(this,null,!0);pmw.setLayout(b),this._initViews(a)},show:function(a){this._initViews(a);var b=M.SwitchHeaderContentLayout.extend({}).create(this,null,!0);b._type===pmw.getLayout()._type?pmw.getLayout().startTransition():this.applicationStart()},applicationReady:function(){},_applyViews:function(){pmw.getLayout().applyViews({header:this.headerView,content:this.contentView})},_initViews:function(){}})}(),pmw.Controllers=pmw.Controllers||{},function(a){"use strict";pmw.Controllers.MenuController=pmw.Controllers.AbstractController.extend({tmpViews:null,_initViews:function(){this.contentView||(this.contentView=pmw.Views.HomeView.create(this,null,!0)),this.headerView||(this.headerView=M.ToolbarView.extend({grid:"col-md-12",value:"Pimp My Wall"}).create()),this._applyViews()},setLocationAndChooseFeature:function(b){a.pmw.selectedWindowGroup=b,localStorage.setItem("selectedWindowGroup",b),pmw.navigate({route:"/chooseFeature"})}})}(this),pmw.Controllers=pmw.Controllers||{},function(a){"use strict";function b(){if(!(WebSocket=window.WebSocket||window.MozWebSocket))return void(t=!1);try{websocket=new WebSocket("ws:this-is-a-fake-url-i-hope-no-one-ever-registers-this-domain.fake-tld"),websocket.close("")}catch(b){t=!0,window.MozWebSocket&&(WebSocket=window.MozWebSocket),u=new WebSocket(a.pmw.options.liveDrawingUrl),y=3,z=1}}function c(a,b){f(!1),v=a,w=b;var c=r/i.canvas.width,d={dateStart:new Date,points:[{x:a*c,y:b*c}],color:o,lineWidth:p};n=d,k.push(d),g(p/c,o,a,b,a+.1,b+.1)}function d(a,b){var c=r/i.canvas.width;i.lineWidth=p,i.strokeStyle=o,g(p/c,o,v,w,a,b),v=a,w=b;var d={x:a*c,y:b*c};k[k.length-1].points.push(d),n.points.push(d),x++,x>y&&(f(!0),x=0)}function e(){f(!1)}function f(b){null!=n&&n.points&&0!=n.points.length&&((new Date).getTime()-n.dateStart.getTime()<z&&b||(n.duration=((new Date).getTime()-n.dateStart.getTime())/1e3,delete n.dateStart,null==u?$.ajax({url:a.pmw.options.serverUrl+"/drawingLive",type:"post",data:n}):u.send(JSON.stringify(n)),n=b?{dateStart:new Date,color:n.color,lineWidth:n.lineWidth,points:[{x:n.points[n.points.length-1].x,y:n.points[n.points.length-1].y}]}:null))}function g(a,b,c,d,e,f){i.save(),i.beginPath(),i.lineCap="round",i.lineJoin="round",i.strokeStyle=b,i.lineWidth=a,i.moveTo(c,d),i.lineTo(e,f),i.stroke(),i.restore()}function h(){var b=Math.round(1e5*Math.random())+1,c=$("<img>").attr("src",a.pmw.options.serverUrl+"/screenshots/"+a.pmw.options.liveDrawingPreviewId+".png?"+b+"=1");c.on("load",function(){console.log("Background loaded!"),i.drawImage(this,0,0,i.canvas.width,i.canvas.height)})}var i,j,k,l,m=null,n={},o="#94c13c",p=10,q=0,r=1024,s=768,t=!1,u=null,v=0,w=0,x=0,y=3,z=500;pmw.Controllers.DrawLiveController=pmw.Controllers.AbstractController.extend({pageHeadline:"Pimp My Wall",selectionSize:M.Model.create({size:5}),strokesMin:10,palette:[["FFFFFF","FF0000","94c13c","0000FF"],["000000","964B00","07ace2","F57900"],["e5287b","75507B","FCE94F","888888"]],backgroundColor:null,_initViews:function(){console.log("AAAA"),backRoute="#chooseFeature",this.contentView||(this.contentView=pmw.Views.DrawLiveView.create(this,null,!0)),this.headerView||(this.headerView=M.ToolbarView.extend({grid:"col-md-12",value:"Pimp My Wall"}).create()),this._applyViews();var a=this,b=[];for(var c in this.palette)for(var d in this.palette[c])b.push(this.palette[c][d]);$(".colorpicker.foreground input").spectrum({showPaletteOnly:!0,showPalette:!0,color:o,palette:a.palette,change:function(a){o=a.toHexString(),localStorage.setItem("Foreground",a.toHexString())}}),$(".selectionSize .selection-list").sizeChooser(this.changeSize),this.newCanvas(),this.clearDraw()},newCanvas:function(){l='<canvas id="canvas" width="'+$(window).width()+'" height="'+($(window).height()-$(".toolbarview").height()-$(".tools").height())+'"></canvas>',$("#contentCanvas").html(l),l=$("#contentCanvas canvas")[0],i=$("#contentCanvas canvas")[0].getContext("2d"),window.addEventListener("resize",this.resizeCanvas.bind(this),!1),window.addEventListener("orientationchange",this.resizeCanvas.bind(this),!1),this.resizeCanvas(),k=[],i.strokeStyle=o,i.lineWidth=p,i.lineCap="round",i.lineJoin="round",$("#contentCanvas canvas").drawTouch(),$("#contentCanvas canvas").drawPointer(),$("#contentCanvas canvas").drawMouse(),b()},darken:function(a){i.save(),q++,30==q?(i.globalAlpha=.05,q=0):i.globalAlpha=a,i.fillStyle="#000",i.fillRect(0,0,i.canvas.width,i.canvas.height),i.restore()},clearDraw:function(){var a=[];for(var b in this.palette)for(var c in this.palette[b])a.push(this.palette[b][c]);this.newCanvas(),i.fillStyle="#000",i.rect(0,0,i.canvas.width,i.canvas.height),i.fill()},changeSize:function(){i.canvas.width/r;p=$(".selectionSize select").val(),i.lineWidth=p},resizeCanvas:function(){var a=s/r,b=$(window).height(),c=$(window).width(),d=0,e=0,f=$(".header").height()+$(".tools").height();b-=f,1/a>c/b?(d=c,e=d*a):(e=b,d=e/a),$("#contentCanvas").width(d),$("#contentCanvas").height(b),l.width=d,l.height=e,i.strokeStyle=o,i.lineWidth=p,i.lineCap="round",i.lineJoin="round",this.repaint()},refreshPreview:function(){h()},repaint:function(){if(k){i.fillStyle=this.backgroundColor,i.clearRect(0,0,l.width,l.height);for(var a=r/i.canvas.width,b=0;b<k.length;b++)for(var c=0;c<k[b].points.length-1;c++)g(k[b].lineWidth/a,k[b].color,k[b].points[c].x/a,k[b].points[c].y/a,k[b].points[c+1].x/a,k[b].points[c+1].y/a);h()}i.lineWidth=p}}),$.fn.drawTouch=function(){var a=function(a){a=a.originalEvent,j=a.changedTouches[0].pageX,m=a.changedTouches[0].pageY-100,c(j,m)},b=function(a){a.preventDefault(),a=a.originalEvent,j=a.changedTouches[0].pageX,m=a.changedTouches[0].pageY-100,d(j,m)},f=function(){e()};$(this).on("touchstart",a.bind(this)),$(this).on("touchmove",b.bind(this)),$(this).on("touchend",f.bind(this))},$.fn.drawPointer=function(){var a=function(a){a=a.originalEvent,j=a.pageX,m=a.pageY-100,c(j,m)},b=function(a){a.preventDefault(),a=a.originalEvent,j=a.pageX,m=a.pageY-100,d(j,m)},f=function(){e()};$(this).on("MSPointerDown",a),$(this).on("MSPointerMove",b),$(this).on("MSPointerUp",f)},$.fn.drawMouse=function(){var a=0,b=function(b){j=b.pageX,m=b.pageY-100,c(j,m),a=1},f=function(b){a&&(j=b.pageX,m=b.pageY-100,d(j,m))},g=function(){a=0,e()};$(this).on("mousedown",b),$(this).on("mousemove",f),$(window).on("mouseup",g)}}(this);