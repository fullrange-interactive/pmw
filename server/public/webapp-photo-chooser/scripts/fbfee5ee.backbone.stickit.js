!function(a){Backbone.Stickit={_handlers:[],addHandler:function(a){a=_.map(_.flatten([a]),function(a){return _.extend({updateModel:!0,updateView:!0,updateMethod:"text"},a)}),this._handlers=this._handlers.concat(a)}},_.extend(Backbone.View.prototype,{_modelBindings:null,unstickit:function(a){_.each(this._modelBindings,_.bind(function(b,c){return a&&b.model!==a?!1:(b.model.off(b.event,b.fn),void delete this._modelBindings[c])},this)),this._modelBindings=_.compact(this._modelBindings),this.$el.off(".stickit"+(a?"."+a.cid:""))},stickit:function(a,b){var d=this,m=a||this.model,n=".stickit."+m.cid,o=b||this.bindings||{};this._modelBindings||(this._modelBindings=[]),this.unstickit(m),_.each(_.keys(o),function(a){var b,p,q,r,s=o[a]||{},t=_.uniqueId();":el"!=a?b=d.$(a):(b=d.$el,a=""),b.length&&(_.isString(s)&&(s={observe:s}),r=i(b,s),q=r.observe,p=_.extend({bindKey:t},r.setOptions||{}),j(d,b,r,m,q),k(d,b,r,m,q),q&&(_.each(r.events||[],function(c){var f=c+n,h=function(a){var c=r.getVal.call(d,b,a,r);e(d,r.updateModel,c,r)&&g(m,q,c,p,d,r)};""===a?d.$el.on(f,h):d.$el.on(f,a,h)}),_.each(_.flatten([q]),function(a){f(m,d,"change:"+a,function(a,c,e){(null==e||e.bindKey!=t)&&l(d,b,r,h(a,q,r,d),a)})}),l(d,b,r,h(m,q,r,d),m,!0)),c(d,r.initialize,b,m,r))}),this.remove=_.wrap(this.remove,function(a){d.unstickit(),a&&a.call(d)})}});var b=function(a,b){var c=(b||"").split("."),d=_.reduce(c,function(a,b){return a[b]},a);return null==d?a:d},c=function(a,b){return b?(_.isString(b)?a[b]:b).apply(a,_.toArray(arguments).slice(2)):void 0},d=function(a){return a.find("option").not(function(){return!this.selected})},e=function(a,b){return _.isBoolean(b)?b:_.isFunction(b)||_.isString(b)?c.apply(this,_.toArray(arguments)):!1},f=function(a,b,c,d){a.on(c,d,b),b._modelBindings.push({model:a,event:c,fn:d})},g=function(a,b,d,e,f,g){g.onSet&&(d=c(f,g.onSet,d,g)),a.set(b,d,e)},h=function(a,b,d,e){var f,g=function(b){var c=d.escape?a.escape(b):a.get(b);return _.isUndefined(c)?"":c};return f=_.isArray(b)?_.map(b,g):g(b),d.onGet?c(e,d.onGet,f,d):f},i=function(a,b){var c=[{updateModel:!1,updateView:!0,updateMethod:"text",update:function(a,b,c,d){a[d.updateMethod](b)},getVal:function(a,b,c){return a[c.updateMethod]()}}];_.each(Backbone.Stickit._handlers,function(b){a.is(b.selector)&&c.push(b)}),c.push(b);var d=_.extend.apply(_,c);return delete d.selector,d},j=function(a,b,c,d,e){var g=["autofocus","autoplay","async","checked","controls","defer","disabled","hidden","loop","multiple","open","readonly","required","scoped","selected"];_.each(c.attributes||[],function(c){var i="",j=c.observe||(c.observe=e),k=function(){var e=_.indexOf(g,c.name,!0)>-1?"prop":"attr",f=h(d,j,c,a);"class"==c.name?(b.removeClass(i).addClass(f),i=f):b[e](c.name,f)};_.each(_.flatten([j]),function(b){f(d,a,"change:"+b,k)}),k()})},k=function(a,b,d,e,g){if(null!=d.visible){var i=function(){var f=d.visible,i=d.visibleFn,j=h(e,g,d,a),k=!!j;(_.isFunction(f)||_.isString(f))&&(k=c(a,f,j,d)),i?c(a,i,b,k,d):k?b.show():b.hide()};_.each(_.flatten([g]),function(b){f(e,a,"change:"+b,i)}),i()}},l=function(a,b,d,f,g,h){e(a,d.updateView,f,d)&&(d.update.call(a,b,f,g,d),h||c(a,d.afterUpdate,b,f,d))};Backbone.Stickit.addHandler([{selector:'[contenteditable="true"]',updateMethod:"html",events:["keyup","change","paste","cut"]},{selector:"input",events:["keyup","change","paste","cut"],update:function(a,b){a.val(b)},getVal:function(a){var b=a.val();return a.is('[type="number"]')?null==b?b:Number(b):b}},{selector:"textarea",events:["keyup","change","paste","cut"],update:function(a,b){a.val(b)},getVal:function(a){return a.val()}},{selector:'input[type="radio"]',events:["change"],update:function(a,b){a.filter('[value="'+b+'"]').prop("checked",!0)},getVal:function(a){return a.filter(":checked").val()}},{selector:'input[type="checkbox"]',events:["change"],update:function(b,c){b.length>1?(c||(c=[]),_.each(b,function(b){_.indexOf(c,a(b).val())>-1?a(b).prop("checked",!0):a(b).prop("checked",!1)})):_.isBoolean(c)?b.prop("checked",c):b.prop("checked",c==b.val())},getVal:function(b){var c;if(b.length>1)c=_.reduce(b,function(b,c){return a(c).prop("checked")&&b.push(a(c).val()),b},[]);else{c=b.prop("checked");var d=b.val();"on"!=d&&null!=d&&(c=c?b.val():null)}return c}},{selector:"select",events:["change"],update:function(d,e,f,g){var h,i=g.selectOptions,j=i&&i.collection||void 0,k=d.prop("multiple");if(!i){i={};var l=function(a){return a.find("option").map(function(){return{value:this.value,label:this.text}}).get()};d.find("optgroup").length?(j={opt_labels:[]},_.each(d.find("optgroup"),function(b){var c=a(b).attr("label");j.opt_labels.push(c),j[c]=l(a(b))})):j=l(d)}i.valuePath=i.valuePath||"value",i.labelPath=i.labelPath||"label";var m=function(c,d,e){i.defaultOption&&(c=_.clone(c),c.unshift("__default__")),_.each(c,function(c){var f=a("<option/>"),g=c,h=function(a,b){f.text(a),g=b,f.data("stickit_bind_val",g),_.isArray(g)||_.isObject(g)||f.val(g)};"__default__"===c?h(i.defaultOption.label,i.defaultOption.value):h(b(c,i.labelPath),b(c,i.valuePath)),!k&&null!=g&&null!=e&&g==e||_.isObject(e)&&_.isEqual(g,e)?f.prop("selected",!0):k&&_.isArray(e)&&_.each(e,function(a){_.isObject(a)&&(a=b(a,i.valuePath)),(a==g||_.isObject(a)&&_.isEqual(g,a))&&f.prop("selected",!0)}),d.append(f)})};d.html("");var n=function(a,c){var d=window;return 0===c.indexOf("this.")&&(d=a),c=c.replace(/^[a-z]*\.(.+)$/,"$1"),b(d,c)};h=_.isString(j)?n(this,j):_.isFunction(j)?c(this,j,d,g):j,h instanceof Backbone.Collection&&(h=h.toJSON()),_.isArray(h)?m(h,d,e):_.each(h.opt_labels,function(b){var c=a("<optgroup/>").attr("label",b);m(h[b],c,e),d.append(c)})},getVal:function(b){var c;return c=b.prop("multiple")?a(d(b).map(function(){return a(this).data("stickit_bind_val")})).get():d(b).data("stickit_bind_val")}}])}(window.jQuery||window.Zepto);