/*global pmw, $*/pmw.Controllers = pmw.Controllers || {};(function (global) {    'use strict';    var sendInterval = 1;    var lastSend = 0;        function shuffle(o){        for(var j, x, i = o.length; i; j = Math.floor(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);        return o;    }        var modalAlert = function (text, hideOk, callback){        if ( hideOk ){            $(".ok-button").hide();        }else{            $(".ok-button").show();        }        $(".modal-alert-text").html(text);        $(".modal-alert-container").addClass("shown");        if ( callback ){            $(".ok-button .button").bind("tap", function (){                callback();                $(".ok-button .button").unbind("tap")            })        }else{            $(".ok-button .button").unbind("tap");            $(".ok-button .button").bind("tap", function (){                $(".modal-alert-container").removeClass("shown");            });        }    }    pmw.Controllers.ChoosePhotoController = pmw.Controllers.AbstractController.extend({        photos: [],                _initViews: function() {            // Create the ContentView with the controller (this) as scope            if( !this.contentView ) {                this.contentView = pmw.Views.ChoosePhotoView.create(this, null, true);            }            this._applyViews();						var that = this;            			$.get(global.pmw.options.serverUrl+"/photoGallery", {				listImages:1			},function (data){				that.photos = data;				that.fillGallery(that);                				$("#photo-gallery").slick({				    //lazyLoad:'ondemand                    prevArrow:'#slide-previous',                    nextArrow:'#slide-next',                    touchThreshold: 20,				});                $("#photo-gallery").on("beforeChange", that.onChange);                			},'json');            window.addEventListener('resize', this.resizeCanvas, false);            window.addEventListener('orientationchange', this.resizeCanvas, false);        },				fillGallery: function(){            this.photos = shuffle(this.photos);			for(var i = 0; i < this.photos.length; i++){				var slide = $('<div class="image" data-image-source="' + global.pmw.options.serverUrl + this.photos[i] + '" style="background-image:url(' + global.pmw.options.serverUrl + this.photos[i] + ')"></div>')				$("#photo-gallery").append(slide)			}		},                onChange: function(event, slick, curSlide, nextSlide){            var current = this;			var selectedImage = $("#photo-gallery").find("div.image[data-slick-index=" + nextSlide + "]").attr("data-image-source");            var now = (new Date()).getTime();            //if ( now - lastSend > sendInterval * 1000 ){                console.log("selectedImage = " + selectedImage);                lastSend = (new Date()).getTime();                $.get(global.pmw.options.serverUrl + "/photoGallery", {                    imageUrl: selectedImage.replace("gallery-bcvs","gallery-bcvs-contrast")                }, function (){}).fail(function (){                    console.log("Probl√®me d'envoi au serveur")                });            //}        },		        resizeCanvas: function() {            var winHeight = window.innerHeight ? window.innerHeight : $(window).height();            var winWidth = $(window).width();            var newWidth = 0;            var newHeight = 0;            var heightMargin = $('.toolbarview').height() + $('.tools').height();            // windows size without header and footer            //winHeight = winHeight - heightMargin;            //$('#photo-gallery').height(winHeight);        }    });})(this);